<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduVerse - Abas + XP</title>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: #f5fdf7;
            margin: 0;
            padding: 0;
            transition: background 0.3s, color 0.3s;
        }
        
        body.dark {
            background: #121212;
            color: #e0e0e0;
        }
        
        body.dark header {
            background: #1b5e20;
        }
        
        body.dark .card,
        body.dark .login-box,
        body.dark #ranking {
            background: #1e1e1e;
            color: #e0e0e0;
        }
        
        body.dark nav button,
        body.dark .sub-nav button {
            background: #333;
            color: #e0e0e0;
        }
        
        body.dark nav button.active,
        body.dark .sub-nav button.active {
            background: #00c853;
            color: white;
        }
        
        header {
            background: #00c853;
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }
        
        nav {
            display: flex;
            gap: 15px;
        }
        
        nav button {
            background: white;
            color: #00c853;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }
        
        .tab-btn {
            display: inline-block;
            /* faz o link se comportar como bloco/inline-block */
            background: #00c853;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            text-decoration: none;
            /* remove sublinhado do link */
            text-align: center;
            /* centraliza o texto */
            transition: 0.3s;
        }
        
        .tab-btn:hover {
            background: #009624;
        }
        
        nav button.active {
            background: #009624;
            color: white;
        }
        
        nav button:hover {
            background: #e8f5e9;
        }
        
        .tab-content {
            display: none;
            padding: 40px 10%;
            animation: fadeIn 0.4s ease-in-out;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        h2,
        h3 {
            text-align: center;
            color: #00c853;
        }
        
        .hero {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 30px;
            text-align: left;
            padding: 60px 20px;
        }
        
        .hero-text {
            max-width: 500px;
        }
        
        .hero-text h2 {
            font-size: 36px;
            margin-bottom: 15px;
        }
        
        .hero-text p {
            font-size: 18px;
            color: #444;
            line-height: 1.6;
        }
        
        .login-box {
            max-width: 400px;
            margin: auto;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .login-box input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border-radius: 10px;
            border: 1px solid #ccc;
        }
        
        .login-box button {
            width: 100%;
            padding: 12px;
            border: none;
            background: #00c853;
            color: white;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .login-box button:hover {
            background: #009624;
        }
        
        .sub-nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .sub-nav button {
            background: #e8f5e9;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }
        
        .sub-nav button.active {
            background: #00c853;
            color: white;
        }
        
        .sub-tab-content {
            display: none;
        }
        
        .sub-tab-content.active {
            display: block;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: 0.3s;
            font-size: 18px;
            cursor: pointer;
        }
        
        .card:hover {
            transform: translateY(-5px);
            background: #e8f5e9;
        }
        
        .avatar-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            text-align: center;
        }
        
        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 4px solid #00c853;
            background: url("https://i.pravatar.cc/150") no-repeat center/cover;
            margin-bottom: 5px;
        }
        
        .user-name {
            font-weight: bold;
            margin-bottom: 3px;
            color: #333;
        }
        
        .level {
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }
        
        .xp-bar {
            width: 80px;
            height: 8px;
            background: #ccc;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .xp-progress {
            height: 100%;
            background: #00c853;
            width: 0%;
            transition: width 0.4s ease;
        }
        
        #ranking {
            max-width: 600px;
            margin: 40px auto;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        #ranking table {
            width: 100%;
            border-collapse: collapse;
        }
        
        #ranking th,
        #ranking td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #ccc;
        }
        
        .rocket-container {
            position: relative;
            width: 150px;
            height: 150px;
        }
        
        #rocket {
            width: 100px;
            animation: fly 2s ease-in-out infinite alternate;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        #rocket.jump {
            transform: translateY(-30px) rotate(-15deg);
            animation: none;
        }
        
        @keyframes fly {
            0% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-20px) rotate(5deg);
            }
            100% {
                transform: translateY(0) rotate(0deg);
            }
        }
        
        .questao-container {
            background: #e8f5e9;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .questao-text {
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        .questao-nav button {
            padding: 8px 16px;
            margin: 0 10px;
            border-radius: 10px;
            border: none;
            background: #00c853;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .questao-nav button:hover {
            background: #009624;
        }
    </style>
</head>

<body>

    <header>
        <h1>EduVerse üöÄ</h1>
        <nav>
            <button class="tab-btn active" onclick="showTab(event,'inicio')">In√≠cio</button>
            <button class="tab-btn" onclick="showTab(event,'login')">Login/Cadastro</button>
            <button class="tab-btn" onclick="showTab(event,'areas')">√Åreas</button>
            <a href="cadastro.html" class="tab-btn">Cadastro de Conte√∫dos</a>
            <button onclick="toggleDarkMode()">üåô</button>
        </nav>
    </header>

    <!-- In√≠cio -->
    <section id="inicio" class="tab-content active">
        <div class="hero">
            <div class="hero-text">
                <h2>Bem-vindo ao EduVerse üöÄ</h2>
                <p>No EduVerse, cada estudante √© um explorador do conhecimento. Aqui, aprender vai al√©m dos livros: √© uma jornada interativa, divertida e cheia de conquistas. Transforme desafios em medalhas, d√∫vidas em descobertas e seu aprendizado em uma
                    verdadeira aventura c√≥smica. üåå‚ú® Participe das ligas semanais, conquiste pontos de XP e suba no ranking.</p>
            </div>
            <div class="rocket-container">
                <img id="rocket" src="foguete mascote.png" alt="Foguete Mascote">
            </div>
        </div>
    </section>

    <!-- Login / Cadastro -->
    <section id="login" class="tab-content">
        <h2>Login / Cadastro</h2>
        <div class="login-box">
            <input type="text" placeholder="Nome completo" id="nome">
            <input type="text" placeholder="E-mail" id="email">
            <input type="password" placeholder="Senha" id="senha">
            <button onclick="registerUser()">Entrar</button>
            <p style="text-align:center; margin-top:15px;">
                Ainda n√£o tem conta? <a href="Cadastre-se.html" style="text-decoration:none; color:black;">Cadastre-se</a>
            </p>
        </div>
    </section>

    <!-- √Åreas -->
    <section id="areas" class="tab-content">
        <h2>√Åreas de Conhecimento</h2>
        <div class="sub-nav">
            <button class="sub-btn active" onclick="showSubTab(event,'escolar')">√Årea Escolar</button>
            <button class="sub-btn" onclick="showSubTab(event,'extras')">Disciplinas Extras</button>
            <button class="sub-btn" onclick="showSubTab(event,'ligas')">Ligas</button>
        </div>

        <!-- Escolar -->
        <div id="escolar" class="sub-tab-content active">
            <h3>√Årea Escolar</h3>
            <div class="grid"></div>
        </div>

        <!-- Extras -->
        <div id="extras" class="sub-tab-content">
            <h3>Disciplinas Extras</h3>
            <div class="grid"></div>
        </div>
        <!-- Cadastro de conte√∫dos -->
        <section id="cadastro de conteudos" class="tab-content">
            <h2>Cadastro de Conte√∫dos</h2>
            <div class="form-container">
                <label>Mat√©ria:</label>
                <input type="text" id="materia" placeholder="Ex: Matem√°tica">

                <label>Assunto:</label>
                <input type="text" id="assunto" placeholder="Ex: √Ålgebra">

                <label>Quest√µes (uma por linha):</label>
                <textarea id="questoes" placeholder="Digite cada quest√£o em uma linha"></textarea>

                <label>Imagem (opcional):</label>
                <input type="file" id="imagem" accept="image/*">

                <div class="preview" id="preview"></div>

                <button onclick="salvarConteudo()">Salvar Conte√∫do</button>
                <p id="msg"></p>
            </div>
        </section>
        <!-- Ligas -->
        <div id="ligas" class="sub-tab-content">
            <h3>Ligas e Ranking</h3>
            <p style="text-align:center; margin-bottom:20px;">
                Participe de desafios semanais, suba de n√≠vel e mostre quem domina o conhecimento!
            </p>
            <div id="ranking">
                <table>
                    <thead>
                        <tr>
                            <th>Posi√ß√£o</th>
                            <th>Nome</th>
                            <th>XP</th>
                            <th>Medalha</th>
                        </tr>
                    </thead>
                    <tbody id="ranking-list"></tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Avatar / XP -->
    <div class="avatar-container">
        <div class="avatar"></div>
        <div class="user-name" id="user-name">Usu√°rio</div>
        <div class="level">N√≠vel <span id="level">1</span></div>
        <div class="xp-bar">
            <div class="xp-progress" id="xp-progress"></div>
        </div>
        <small><span id="xp">0</span>/100 XP</small>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // üîó Conex√£o com o Supabase
        const supabaseUrl = 'https://iiplwwaegrofgknpoxtu.supabase.co'
        const supabaseKey = process.env.SUPABASE_KEY
        const supabase = createClient(supabaseUrl, supabaseKey)

        let xp = 0;
        let level = 1;
        let userName = "Usu√°rio";
        const xpBar = document.getElementById("xp-progress");
        const xpText = document.getElementById("xp");
        const levelText = document.getElementById("level");
        const userNameText = document.getElementById("user-name");
        const rankingList = document.getElementById("ranking-list");

        // Carregar dados do localStorage
        if (localStorage.getItem('userData')) {
            const data = JSON.parse(localStorage.getItem('userData'));
            userName = data.userName;
            xp = data.xp;
            level = data.level;
            userNameText.textContent = userName;
        }

        // Ranking inicial
        let ranking = JSON.parse(localStorage.getItem('ranking')) || [{
            name: "Alice",
            xp: 50
        }, {
            name: "Bob",
            xp: 30
        }, {
            name: "Charlie",
            xp: 10
        }, {
            name: userName,
            xp: xp
        }];

        function saveUser() {
            localStorage.setItem('userData', JSON.stringify({
                userName,
                xp,
                level
            }));
            localStorage.setItem('ranking', JSON.stringify(ranking));
        }

        function showTab(event, tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        function showSubTab(event, subId) {
            document.querySelectorAll('.sub-tab-content').forEach(sub => sub.classList.remove('active'));
            document.querySelectorAll('.sub-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(subId).classList.add('active');
            event.target.classList.add('active');
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark');
        }

        function rocketJump() {
            const rocket = document.getElementById("rocket");
            rocket.classList.add("jump");
            setTimeout(() => rocket.classList.remove("jump"), 500);
        }

        function addXP(amount) {
            xp += amount;
            if (xp >= 100) {
                xp -= 100;
                level++;
            }
            updateXP();
            rocketJump();
            saveUser();
        }

        function updateXP() {
            xpBar.style.width = xp + "%";
            xpText.innerText = xp;
            levelText.innerText = level;
            let userObj = ranking.find(p => p.name === userName);
            if (userObj) userObj.xp = level * 100 + xp;
            else ranking.push({
                name: userName,
                xp: level * 100 + xp
            });
            updateRanking();
        }

        // Fun√ß√£o completa de ranking interativo
        function updateRanking() {
            ranking.sort((a, b) => b.xp - a.xp);
            rankingList.innerHTML = "";

            ranking.forEach((p, i) => {
                const tr = document.createElement('tr');

                const posTd = document.createElement('td');
                posTd.textContent = i + 1;
                const nameTd = document.createElement('td');
                nameTd.textContent = p.name;

                const xpTd = document.createElement('td');
                const xpBarContainer = document.createElement('div');
                xpBarContainer.style.width = "100px";
                xpBarContainer.style.height = "10px";
                xpBarContainer.style.background = "#ccc";
                xpBarContainer.style.borderRadius = "5px";
                xpBarContainer.style.overflow = "hidden";
                xpBarContainer.style.display = "inline-block";
                xpBarContainer.style.verticalAlign = "middle";

                const xpProgress = document.createElement('div');
                xpProgress.style.height = "100%";
                xpProgress.style.background = "#00c853";
                const levelXP = p.xp % 100;
                xpProgress.style.width = levelXP + "%";

                xpBarContainer.appendChild(xpProgress);

                const xpNumber = document.createElement('span');
                xpNumber.textContent = ` ${p.xp} XP`;
                xpNumber.style.marginLeft = "5px";

                xpTd.appendChild(xpBarContainer);
                xpTd.appendChild(xpNumber);

                const medalTd = document.createElement('td');
                if (i === 0) medalTd.textContent = "üèÜ";
                else if (i === 1) medalTd.textContent = "ü•à";
                else if (i === 2) medalTd.textContent = "ü•â";

                tr.appendChild(posTd);
                tr.appendChild(nameTd);
                tr.appendChild(xpTd);
                tr.appendChild(medalTd);

                rankingList.appendChild(tr);
            });

            saveUser();
        }

        function registerUser() {
            const nomeInput = document.getElementById("nome").value;
            const emailInput = document.getElementById("email").value;
            const senhaInput = document.getElementById("senha").value;

            if (nomeInput && emailInput && senhaInput) {
                userName = nomeInput;
                userNameText.textContent = userName;

                if (!ranking.find(p => p.name === userName))
                    ranking.push({
                        name: userName,
                        xp: 0
                    });

                alert(`Cadastro realizado! Bem-vindo(a) ${userName}!\nUse suas abas de conhecimento para ganhar XP e subir no ranking!`);

                saveUser();
                updateXP();
            } else alert("Por favor, preencha todos os campos para se cadastrar.");
        }


        fetch('materias.json')
            .then(res => res.json())
            .then(data => {
                // Escolar
                const escolarGrid = document.querySelector('#escolar .grid');
                data.escolar.forEach(materia => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerText = `${materia.icone} ${materia.nome}`;
                    card.onclick = () => addXP(materia.xp);
                    mostrarAssuntos(materia.nome);
                    escolarGrid.appendChild(card);
                });

                // Extras
                const extrasGrid = document.querySelector('#extras .grid');
                data.extras.forEach(materia => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerText = `${materia.icone} ${materia.nome}`;
                    card.onclick = () => addXP(materia.xp);
                    extrasGrid.appendChild(card);
                });
            });

        updateXP();
        updateRanking();

        async function carregarMaterias() {
            // Escolar
            const {
                data: materiasEscolar,
                error: err1
            } = await supabase
                .from('materias')
                .select('*')
                .eq('tipo', 'escolar'); // supondo que voc√™ tenha coluna "tipo"

            if (err1) return console.error(err1);

            const escolarGrid = document.querySelector('#escolar .grid');
            escolarGrid.innerHTML = "";

            materiasEscolar.forEach(materia => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerText = `${materia.icone} ${materia.nome}`;
                card.onclick = () => addXP(materia.xp);
                card.onclick = () => mostrarAssuntos(materia.nome);
                escolarGrid.appendChild(card);
            });

            // Extras
            const {
                data: materiasExtras,
                error: err2
            } = await supabase
                .from('materias')
                .select('*')
                .eq('tipo', 'extra');

            if (err2) return console.error(err2);

            const extrasGrid = document.querySelector('#extras .grid');
            extrasGrid.innerHTML = "";

            materiasExtras.forEach(materia => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerText = `${materia.icone} ${materia.nome}`;
                card.onclick = () => addXP(materia.xp);
                card.onclick = () => mostrarAssuntos(materia.nome);
                extrasGrid.appendChild(card);
            });
        }

        // Mostrar assuntos de uma mat√©ria
        async function mostrarAssuntos(materiaNome) {
            const containerId = materiaNome.toLowerCase() + "-grid";
            let container = document.getElementById(containerId);

            if (!container) {
                container = document.createElement('div');
                container.id = containerId;
                container.className = "grid";
                document.getElementById('areas').appendChild(container);
            }

            container.innerHTML = "";

            const {
                data: conteudos,
                error
            } = await supabase
                .from('conteudos')
                .select('*')
                .eq('materia', materiaNome);

            if (error) {
                console.error(error);
                container.innerHTML = "<p>Erro ao carregar conte√∫dos.</p>";
                return;
            }

            if (!conteudos || conteudos.length === 0) {
                container.innerHTML = "<p>Sem conte√∫dos dispon√≠veis.</p>";
                return;
            }

            conteudos.forEach(conteudo => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerText = `üìò ${conteudo.assunto}`;
                card.onclick = () => mostrarQuestoes(conteudo);
                container.appendChild(card);
            });
        }

        // Mostrar quest√µes de um assunto
        function mostrarQuestoes(conteudo) {
            const oldContainer = document.querySelector('.questao-container');
            if (oldContainer) oldContainer.remove();

            let index = 0;
            const container = document.createElement('div');
            container.className = 'questao-container';

            const titulo = document.createElement('h3');
            titulo.textContent = conteudo.assunto;

            const questaoText = document.createElement('div');
            questaoText.className = 'questao-text';

            const nav = document.createElement('div');
            nav.className = 'questao-nav';

            const prevBtn = document.createElement('button');
            prevBtn.textContent = 'Anterior';
            prevBtn.onclick = () => {
                if (index > 0) index--;
                atualizarQuestao();
            };

            const nextBtn = document.createElement('button');
            nextBtn.textContent = 'Pr√≥xima';
            nextBtn.onclick = () => {
                if (index < conteudo.questoes.length - 1) index++;
                atualizarQuestao();
            };

            nav.appendChild(prevBtn);
            nav.appendChild(nextBtn);

            container.appendChild(titulo);
            container.appendChild(questaoText);
            container.appendChild(nav);
            document.getElementById('areas').appendChild(container);

            function atualizarQuestao() {
                questaoText.innerHTML = `<p>${conteudo.questoes[index]}</p>
            <small>Quest√£o ${index + 1} de ${conteudo.questoes.length}</small>`;
            }

            atualizarQuestao();
        }

        // Chama ao iniciar
        carregarMaterias();
    </script>
</body>

</html>